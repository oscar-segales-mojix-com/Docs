[{"id":"1261c35d.b576bd","type":"subflow","name":"Vizix Event (4)","info":"","in":[{"x":140,"y":126,"wires":[{"id":"2a1e01c3.ece67e"}]}],"out":[]},{"id":"b86e2294.1e9db","type":"vizixgetthing","z":"1261c35d.b576bd","name":"Get Vizix Event","vizix_thingId":"","vizix_where":"","vizix_debug":false,"vizix_encode":true,"vizix_server":"d0bfc14b.85ace","x":420,"y":180,"wires":[["79c0ceda.3ecec"]]},{"id":"79c0ceda.3ecec","type":"function","z":"1261c35d.b576bd","name":"","func":"if(!msg.payload || !msg.payload.thingData || !msg.event){\n    return null;\n}\nvar eventUpdate = msg.event || '';\nvar event = msg.payload.thingData;\nvar eventThing = [];\nvar eventID = (parseInt(event.Event_ID) || 0) + 1;\nvar updJson = { \n                \"thingTypeCode\" : \"\"+event.thingTypeCode,\n                \"serialNumber\":\"\"+event.serialNumber,\n                \"group\": \"\"+event.hierarchyName,\n                \"udfs\": {}\n                //\"udfs\": {'eventId':{value:\"\"+ eventID}}\n        };\n        for (var prop in eventUpdate){\n            if(eventUpdate.hasOwnProperty(prop)){\n                updJson.udfs[prop] = {value:eventUpdate[prop]};\n            }\n        }\neventThing.push(updJson);\nmsg.payload = eventThing;\nreturn msg;","outputs":1,"noerr":0,"x":525,"y":256,"wires":[["1712f7ae.61e358"]]},{"id":"1712f7ae.61e358","type":"vizixupdatething","z":"1261c35d.b576bd","name":"","vizix_thingId":"","vizix_fieldId":"","vizix_groupPath":"","vizix_thingType":"","vizix_debug":"","vizix_server":"d0bfc14b.85ace","x":675,"y":188,"wires":[["69eaea0f.07dd34"]]},{"id":"69eaea0f.07dd34","type":"debug","z":"1261c35d.b576bd","name":"Vizix Event","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":670,"y":60,"wires":[]},{"id":"8cdb11e4.b98b3","type":"function","z":"1261c35d.b576bd","name":"","func":"var hierarchyCode = global.get('ViZixEventHierarchyCode') || '';\nvar eventSerial = global.get('ViZixEvent') || '';\nmsg.payload = {\"where\": \"thingTypeCode=vizixEvent&hierarchyCode='\"+ hierarchyCode+\"'&serialNumber='\" + eventSerial + \"'\"};\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":180,"wires":[["b86e2294.1e9db"]]},{"id":"2a1e01c3.ece67e","type":"function","z":"1261c35d.b576bd","name":"","func":"var hierarchyCode = global.get('ViZixEventHierarchyCode') || '';\n// var eventSerial = global.get('ViZixEvent') || '';\n// msg.payload = {\"where\": \"thingTypeCode=vizixEvent&hierarchyCode='\"+ hierarchyCode+\"'&serialNumber='\" + eventSerial + \"'\"};\n// return msg;\nvar eventCode = msg.eventCode || '';\nvar apiKey = global.get('ApiKey') || '';\nvar hierarchyCode = global.get('ViZixEventHierarchyCode') || '';\nvar eventUpdate = msg.event || '';\nmsg.method = \"PUT\";\nmsg.url = \"https://retail.mojix.io/riot-core-services/api/platform/events/FLOW/\" + eventCode + \"/Success\";\nmsg.headers = {\"Api_Key\":apiKey,\"Keep-Alive\": timeout=240};\nvar timezone = global.get(msg.storeId+\"TimeZone\");\n\nmsg.payload = {\n    \"Event_HierarchyGroup\": hierarchyCode,\n}\nfor (var prop in eventUpdate){\n    if(eventUpdate.hasOwnProperty(prop)){\n        msg.payload[prop] = eventUpdate[prop];\n    }\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":134,"wires":[["2dc56818.53a2d8"]]},{"id":"2dc56818.53a2d8","type":"http request","z":"1261c35d.b576bd","name":"","method":"use","ret":"txt","url":"","tls":"","x":490,"y":134,"wires":[["69eaea0f.07dd34"]]},{"id":"d0bfc14b.85ace","type":"vizix-server","z":"","apikey":"PVZKMAGZQO","host":"https://pe.retail.mojix.io","port":""},{"id":"e5f6bdc4.75b92","type":"inject","z":"d7b8c14c.bc41b","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":470,"y":980,"wires":[["68187940.ef78e8"]]},{"id":"68187940.ef78e8","type":"function","z":"d7b8c14c.bc41b","name":"","func":"var stats = flow.get('eventStats') || null;\nif(stats){\nvar storeNum = global.get('StoreID') || '';\nvar storeName = global.get('StoreName') || '';\nvar tenant = global.get('hierarchyGroup') || '';\nvar remoteSource = global.get('remoteSource') || ''\ntenant = tenant.replace('/','');\nvar vizixEvent = {\n                //'Event_Category':'Daily count Stats',\n                //'Event_SubCategory':'FLOW Stats',\n                //'Event_Activity':'Stats',\n                //'Event_Status':'SUCCESS',\n                'Event_Action': 'Count stats',\n                //'Event_Source': 'FLOW',\n                //'Event_Level': 'INFO',\n                'Event_Count':stats.stolen,\n                //'Event_User': 'root',\n                'Event_GroupCode': storeNum,\n                'Event_Detail':{\n                    'storeNumber': storeNum,\n                    'store': storeName,\n                    'stolen_count':stats.stolen,\n                    'unknown_count':stats.unknown,\n                    'sold_count':stats.sold,\n                    'tenant' : tenant,\n\t\t            'thingType': 'Item',\n\t\t            'remoteSource':remoteSource\n                }\n    }\nmsg.event = vizixEvent;\nmsg.eventCode = '605002';\nreturn msg;\n}","outputs":1,"noerr":0,"x":650,"y":980,"wires":[["a6bc0856.fe5868"]]},{"id":"a6bc0856.fe5868","type":"subflow:1261c35d.b576bd","z":"d7b8c14c.bc41b","name":"","x":900,"y":980,"wires":[]},{"id":"91d00ebf.56619","type":"comment","z":"d7b8c14c.bc41b","name":"Daily Count Stats","info":"","x":630,"y":940,"wires":[]},{"id":"514250cd.0b591","type":"link in","z":"d7b8c14c.bc41b","name":"Yellow In","links":["a11fda3a.d772f8","f3d53f88.b1b42"],"x":235,"y":220,"wires":[["40dea448.07175c","c55d952d.2ce2f8","77f72c49.859cb4"]]},{"id":"9625aaad.d90358","type":"ui_text","z":"d7b8c14c.bc41b","group":"2a5a8943.e7f976","order":1,"width":"6","height":"3","name":"","label":"POE GATE","format":"{{msg.payload.logicalReader}}","layout":"col-center","x":410,"y":80,"wires":[]},{"id":"e2b1884b.c971e8","type":"ui_text","z":"d7b8c14c.bc41b","group":"","order":2,"width":"6","height":"1","name":"","label":"EPC","format":"{{msg.payload.epc}}","layout":"row-right","x":370,"y":620,"wires":[]},{"id":"a95c09bb.e6c648","type":"ui_ui_control","z":"d7b8c14c.bc41b","name":"","x":380,"y":660,"wires":[[]]},{"id":"18be2ea7.8e56e1","type":"ui_template","z":"d7b8c14c.bc41b","group":"2a5a8943.e7f976","name":"","order":0,"width":"8","height":"5","format":"<!--\n<div class=\"w3-container\" margin=\"auto\">\n    <div layout=\"row\" layout-align=\"space-between\"  >\n        <p ng-style=\"{color: 'darkorange'}\" ng-if = \"msg.redLight\">EPC: </p>\n        <p ng-style=\"{color: 'darkorange'}\" ng-if = \"msg.redLight\">\n          {{(msg.payload.epc || 0) }}\n        </p>\n    </div>\n    <div ng-if = \"msg.redLight\" layout=\"row\" layout-align=\"space-between\" >\n        <p ng-style=\"{color: 'darkorange'}\" ng-if = \"msg.redLight\">SKU: </p>\n        <p ng-style=\"{color: 'darkorange'}\" ng-if = \"msg.redLight\">\n             {{(msg.payload.SKU ||  \"0\") }} \n        </p>\n    </div>\n    <div ng-if = \"msg.redLight\" layout=\"row\" layout-align=\"space-between\"  >\n        <p ng-style=\"{color: 'darkorange'}\" ng-if = \"msg.redLight\">Class: </p>\n        <p ng-style=\"{color: 'darkorange'}\" ng-if = \"msg.redLight\"> {{(msg.payload.Class || \"\" ) }} </p>\n        \n    </div>\n    <div ng-if = \"msg.redLight\" layout=\"row\" layout-align=\"space-between\"  >\n        <p ng-style=\"{color: 'darkorange'}\" ng-if = \"msg.redLight\">Department: </p>\n        <p ng-style=\"{color: 'darkorange'}\" ng-if = \"msg.redLight\"> {{(msg.payload.Department || \"\" ) }} </p>\n        \n    </div>\n    <div ng-if = \"msg.redLight\" layout=\"row\" layout-align=\"space-between\" >\n        <p ng-style=\"{color: 'darkorange'}\" ng-if = \"msg.redLight\">SA Clearance: </p>\n        <p ng-style=\"{color: 'darkorange'}\" ng-if = \"msg.redLight\"> {{(msg.payload.SA_Clearance || \"\" ) }} </p>\n        \n    </div>\n    <div ng-if = \"msg.redLight\" layout=\"row\" layout-align=\"space-between\" style= \"border-width: 2px;border-bottom-width:2px; border-bottom-color:White;border-bottom-style: solid;\">\n        <p ng-style=\"{color: 'darkorange'}\" ng-if = \"msg.redLight\"> CALL THE SHERIFF </p>\n    </div>\n</div>\n\n-->\n\n<div class=\"w3-container\" margin=\"auto\" ng-repeat=\"x in msg.payload\">\n    <div layout=\"row\" layout-align=\"space-between\"  >\n        <p ng-style=\"{color: 'darkorange'}\" ng-if = \"msg.redLight\">EPC: </p>\n        <p ng-style=\"{color: 'darkorange'}\" ng-if = \"msg.redLight\">\n          {{(x.epc || 0) }}\n        </p>\n    </div>\n    <div ng-if = \"msg.redLight\" layout=\"row\" layout-align=\"space-between\" >\n        <p ng-style=\"{color: 'darkorange'}\" ng-if = \"msg.redLight\">SKU: </p>\n        <p ng-style=\"{color: 'darkorange'}\" ng-if = \"msg.redLight\">\n             {{(x.SKU ||  \"0\") }} \n        </p>\n    </div>\n    <div ng-if = \"msg.redLight\" layout=\"row\" layout-align=\"space-between\"  >\n        <p ng-style=\"{color: 'darkorange'}\" ng-if = \"msg.redLight\">Class: </p>\n        <p ng-style=\"{color: 'darkorange'}\" ng-if = \"msg.redLight\"> {{(x.Class || \"\" ) }} </p>\n        \n    </div>\n    <div ng-if = \"msg.redLight\" layout=\"row\" layout-align=\"space-between\"  >\n        <p ng-style=\"{color: 'darkorange'}\" ng-if = \"msg.redLight\">Department: </p>\n        <p ng-style=\"{color: 'darkorange'}\" ng-if = \"msg.redLight\"> {{(x.Department || \"\" ) }} </p>\n        \n    </div>\n    <div ng-if = \"msg.redLight\" layout=\"row\" layout-align=\"space-between\" style= \"border-width: 2px;border-bottom-width:2px; border-bottom-color:DarkGray;border-bottom-style: solid;\">\n        <p ng-style=\"{color: 'darkorange'}\" ng-if = \"msg.redLight\">SA Clearance: </p>\n        <p ng-style=\"{color: 'darkorange'}\" ng-if = \"msg.redLight\"> {{(x.SA_Clearance || \"\" ) }} </p>\n        \n    </div>\n    <!--<div ng-if = \"msg.redLight\" layout=\"row\" layout-align=\"space-between\" style= \"border-width: 2px;border-bottom-width:2px; border-bottom-color:DarkGray;border-bottom-style: solid;\">\n        <p ng-style=\"{color: 'darkorange'}\" ng-if = \"msg.redLight\"> CALL THE SHERIFF </p>\n    </div> -->\n</div>\n\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":880,"y":140,"wires":[[]]},{"id":"38841b13.9445d4","type":"ui_template","z":"d7b8c14c.bc41b","group":"f4c9a41c.645928","name":"","order":2,"width":"8","height":"5","format":"<!--<div style=\"overflow: auto\" layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: 'yellow'}\" ng-if = \"msg.yellowDisplay\"> EPC Unknown </p>\n    <p ng-style=\"{color: 'yellow'}\" ng-if = \"msg.yellowDisplay\">\n      {{(msg.payload.epc || 0) }}\n    </p>\n</div> -->\n<div style=\"display: block\"   layout=\"row\" layout-align=\"space-between\">\n    <div layout=\"row\" style= \"overflow-y: auto\" layout-align=\"space-between\" ng-repeat=\"x in msg.payload\">\n        <p ng-style=\"{color: 'yellow'}\"> EPC Unknown </p> \n        <p ng-style=\"{color: 'yellow'}\">\n            {{x.epc}}\n        </p> \n    </div>\n</div>\n\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":880,"y":220,"wires":[[]]},{"id":"90c12162.65486","type":"ui_template","z":"d7b8c14c.bc41b","group":"453b4738.0acee8","name":"","order":0,"width":"8","height":"5","format":"<!-- <div class=\"w3-container\" margin=\"auto\">\n    <div layout=\"row\" layout-align=\"space-between\">\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\"> EPC SOLD</p>\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\">\n          {{(msg.payload.epc || 0) }}\n        </p>\n    </div>\n     <div ng-if = \"msg.greenLight\" layout=\"row\" layout-align=\"space-between\" >\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\">SKU: </p>\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\">\n             {{(msg.payload.SKU ||  \"0\") }} \n        </p>\n    </div>\n     <div ng-if = \"msg.greenLight\" layout=\"row\" layout-align=\"space-between\"  >\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\">Class: </p>\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\"> {{(msg.payload.Class || \"\" ) }} </p>\n        \n    </div>\n    <div ng-if = \"msg.greenLight\" layout=\"row\" layout-align=\"space-between\"  >\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\">Department: </p>\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\"> {{(msg.payload.Department || \"\" ) }} </p>\n        \n    </div>\n    <div ng-if = \"msg.greenLight\" layout=\"row\" layout-align=\"space-between\" >\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\">SA Clearance: </p>\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\"> {{(msg.payload.SA_Clearance || \"\" ) }} </p>\n        \n    </div>\n</div> -->\n\n<div class=\"w3-container\" margin=\"auto\" ng-repeat=\"x in msg.payload\">\n    <div layout=\"row\" layout-align=\"space-between\">\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\"> EPC SOLD</p>\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\">\n          {{(x.epc || 0) }}\n        </p>\n    </div>\n     <div ng-if = \"msg.greenLight\" layout=\"row\" layout-align=\"space-between\" >\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\">SKU: </p>\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\">\n             {{(x.SKU ||  \"0\") }} \n        </p>\n    </div>\n     <div ng-if = \"msg.greenLight\" layout=\"row\" layout-align=\"space-between\"  >\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\">Class: </p>\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\"> {{(x.Class || \"\" ) }} </p>\n        \n    </div>\n    <div ng-if = \"msg.greenLight\" layout=\"row\" layout-align=\"space-between\"  >\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\">Department: </p>\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\"> {{(x.Department || \"\" ) }} </p>\n        \n    </div>\n    <div ng-if = \"msg.greenLight\" layout=\"row\" layout-align=\"space-between\" style= \"border-width: 2px;border-bottom-width:2px; border-bottom-color:DarkGray;border-bottom-style: solid;\" >\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\">SA Clearance: </p>\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\"> {{(x.SA_Clearance || \"\" ) }} </p>\n        \n    </div>\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":880,"y":280,"wires":[[]]},{"id":"2c107709.7e2278","type":"link in","z":"d7b8c14c.bc41b","name":"Red In","links":["be5351c5.4b58b","f0c28207.bb4c"],"x":235,"y":140,"wires":[["9625aaad.d90358","c55d952d.2ce2f8","77f72c49.859cb4"]]},{"id":"4f6d19e8.28b6b8","type":"link in","z":"d7b8c14c.bc41b","name":"Green In","links":["4de0f3fc.42762c","625df602.218668"],"x":235,"y":280,"wires":[["31a6de7c.f92142","c55d952d.2ce2f8","77f72c49.859cb4"]]},{"id":"40dea448.07175c","type":"ui_text","z":"d7b8c14c.bc41b","group":"f4c9a41c.645928","order":1,"width":"8","height":"3","name":"","label":"POE GATE","format":"{{msg.payload.logicalReader}}","layout":"col-center","x":410,"y":180,"wires":[]},{"id":"31a6de7c.f92142","type":"ui_text","z":"d7b8c14c.bc41b","group":"453b4738.0acee8","order":1,"width":"6","height":"3","name":"","label":"POE GATE","format":"{{msg.payload.logicalReader}}","layout":"col-center","x":410,"y":280,"wires":[]},{"id":"3f9ee49e.8dad3c","type":"ui_gauge","z":"d7b8c14c.bc41b","name":"","group":"78053794.771368","order":1,"width":"5","height":"3.5","gtype":"donut","title":"Stolen","label":"units","format":"{{value}}","min":0,"max":"100","colors":["#ca3838","#ca3838","#ca3838"],"seg1":"","seg2":"","x":730,"y":460,"wires":[]},{"id":"fcb89fe5.048b8","type":"ui_button","z":"d7b8c14c.bc41b","name":"clean","group":"78053794.771368","order":5,"width":"0","height":"0","passthru":false,"label":"Clean Dashboard","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":550,"y":180,"wires":[["ca12b812.9f32c8","d324a6ac.741548"]]},{"id":"ca12b812.9f32c8","type":"function","z":"d7b8c14c.bc41b","name":"","func":"msg.yellowDisplay = false;\nmsg.redDisplay = false;\nmsg.greenDisplay = false;\nmsg.blackList = false;\nmsg.payload = '';\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":180,"wires":[["18be2ea7.8e56e1","38841b13.9445d4","90c12162.65486","8965cf80.1682","8c3c5741.a5feb8","903b8704.4abd38","6a2cc6ef.aa0c18"]]},{"id":"8965cf80.1682","type":"link out","z":"d7b8c14c.bc41b","name":"clean UI","links":["daec0333.5bbf8"],"x":900,"y":180,"wires":[]},{"id":"daec0333.5bbf8","type":"link in","z":"d7b8c14c.bc41b","name":"clean UI in","links":["8965cf80.1682"],"x":75,"y":180,"wires":[["9625aaad.d90358","8d9d5369.22529","40dea448.07175c","31a6de7c.f92142"]]},{"id":"77f72c49.859cb4","type":"function","z":"d7b8c14c.bc41b","name":"","func":"if(!!msg.payload){\n    var eventStats = flow.get(\"eventStats\") || {stolen: 0, unknown:0, sold:0, blackList: 0 };\n    var events = msg.payload;\n    var eventsInject = {\"redLight\":\"stolen\",\"yellowDisplay\": \"unknown\", \"greenLight\": \"sold\", };\n    var eventType = \"\";\n    var chart = [];\n    //node.warn(\"EVENTS\");\n    //node.warn(events);\n    \n    if(msg.redLight){ \n        eventType = \"redLight\";\n        if(!eventStats.hasOwnProperty('stolen')){\n            eventStats.stolen = 0;\n        } \n       // node.warn(events.length);\n       // node.warn(eventStats.stolen);\n       // node.warn(events);\n        eventStats.stolen = eventStats.stolen + events.length;\n    }\n    if(msg.yellowDisplay){\n        eventType = \"yellowDisplay\";\n        if(!eventStats.hasOwnProperty('unknown')){\n            eventStats.unknown = 0;\n        }\n        // node.warn(events.length);\n        // node.warn(eventStats.unknown);\n        // node.warn(events);\n        eventStats.unknown = eventStats.unknown + events.length;\n\n    }\n    if(msg.greenLight){\n        eventType = \"greenLight\";\n        if(!eventStats.hasOwnProperty('sold')){\n            eventStats.sold = 0;\n        } \n        eventStats.sold = eventStats.sold + events.length;\n    }\n    \n    if(msg.blackList){\n        //node.warn('blackList');\n        eventType = \"blackList\";\n        \n        if(!eventStats.hasOwnProperty('blackList')){\n            eventStats.blackList = 0;\n        } \n        eventStats.blackList = eventStats.blackList + events.length;\n    }\n    \n    \n\n    flow.set('eventStats',eventStats);\n    // msg.topic = eventsInject[eventType];\n    // node.warn(eventStats);\n    // node.warn(eventType);\n    // msg.payload = eventStats[eventsInject[eventType]];\n}\n//node.warn(eventStats);\nfor(var event in eventStats){\n    chart.push({topic:event, payload: eventStats[event]});\n}\nreturn [chart];","outputs":1,"noerr":0,"x":370,"y":520,"wires":[["f586fab1.457fb8","c98fd1e.c63cc3","d7755885.dbf358"]]},{"id":"f586fab1.457fb8","type":"ui_chart","z":"d7b8c14c.bc41b","name":"","group":"41d308fa.98faa8","order":0,"width":"19","height":"10","label":"chart","chartType":"bar","legend":"true","xformat":"HH:mm:ss","interpolate":"step","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#9b0000","#ffff00","#008000","#348998","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":730,"y":420,"wires":[[],[]]},{"id":"c98fd1e.c63cc3","type":"debug","z":"d7b8c14c.bc41b","name":"Chart","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":590,"y":580,"wires":[]},{"id":"7b724505.5d09fc","type":"ui_gauge","z":"d7b8c14c.bc41b","name":"","group":"78053794.771368","order":2,"width":"5","height":"3.5","gtype":"donut","title":"Sold","label":"units","format":"{{value}}","min":0,"max":"100","colors":["#00b500","#00b500","#00b500"],"seg1":"","seg2":"","x":730,"y":500,"wires":[]},{"id":"eedee332.79e2a","type":"ui_gauge","z":"d7b8c14c.bc41b","name":"","group":"78053794.771368","order":3,"width":"5","height":"3.5","gtype":"donut","title":"Unknown","label":"units","format":"{{value}}","min":0,"max":"100","colors":["#e6e600","#e6e600","#e6e600"],"seg1":"","seg2":"","x":740,"y":540,"wires":[]},{"id":"d7755885.dbf358","type":"switch","z":"d7b8c14c.bc41b","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"stolen","vt":"str"},{"t":"eq","v":"sold","vt":"str"},{"t":"eq","v":"unknown","vt":"str"},{"t":"eq","v":"blackList","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":590,"y":520,"wires":[["3f9ee49e.8dad3c"],["7b724505.5d09fc"],["eedee332.79e2a"],["f3fea99f.7a53d8"]]},{"id":"afae0d2c.5ba6e","type":"ui_dropdown","z":"d7b8c14c.bc41b","name":"","label":"Select Event","place":"Select option","group":"","order":1,"width":"6","height":"2","passthru":true,"options":[{"label":"Stolen","value":"stolen","type":"str"},{"label":"Solds","value":"sold","type":"str"},{"label":"Unknown","value":"unknown","type":"str"}],"payload":"","topic":"","x":450,"y":740,"wires":[["b38f4d96.f4b9a"]]},{"id":"b38f4d96.f4b9a","type":"function","z":"d7b8c14c.bc41b","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":740,"wires":[["5b81088f.e50b08"]]},{"id":"5b81088f.e50b08","type":"ui_template","z":"d7b8c14c.bc41b","group":"","name":"","order":3,"width":0,"height":0,"format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":760,"y":740,"wires":[[]]},{"id":"de86706d.31fc5","type":"inject","z":"d7b8c14c.bc41b","name":"Clean analytics","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"59 23 * * *","once":false,"onceDelay":0.1,"x":430,"y":460,"wires":[["d324a6ac.741548"]]},{"id":"d324a6ac.741548","type":"function","z":"d7b8c14c.bc41b","name":"","func":"flow.set('eventStats',{stolen: 0, unknown:0, sold:0, blackList: 0 });\nflow.set('eventList', {stolen: [], unknown:[], sold:[],blackList: [] })  ;\nflow.set(\"posList\", []);\nflow.set(\"tagList\", []);\nvar clean = [{topic:\"stolen\", payload:0},{topic:\"unknown\", payload:0},{topic:\"sold\", payload:0}, {topic:\"blackList\", payload:0}]\nreturn [clean];","outputs":1,"noerr":0,"x":590,"y":360,"wires":[["f586fab1.457fb8","d7755885.dbf358"]]},{"id":"24585054.d0a89","type":"debug","z":"d7b8c14c.bc41b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1170,"y":380,"wires":[]},{"id":"cf789f8.0911e6","type":"ui_switch","z":"d7b8c14c.bc41b","name":"","label":"Alarm","group":"78053794.771368","order":4,"width":"3","height":"3","passthru":true,"decouple":"false","topic":"","style":"","onvalue":"ON","onvalueType":"str","onicon":"","oncolor":"","offvalue":"OFF","offvalueType":"str","officon":"","offcolor":"","x":1010,"y":420,"wires":[["24585054.d0a89","65e74c8b.f13b64","49421000.f3365"]]},{"id":"2cbb4408.fc58ac","type":"inject","z":"d7b8c14c.bc41b","name":"","topic":"","payload":"ON","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":890,"y":460,"wires":[["cf789f8.0911e6"]]},{"id":"65e74c8b.f13b64","type":"ui_text","z":"d7b8c14c.bc41b","group":"78053794.771368","order":0,"width":"2","height":"3","name":"","label":"","format":"{{msg.payload}}","layout":"row-spread","x":1170,"y":420,"wires":[]},{"id":"49421000.f3365","type":"function","z":"d7b8c14c.bc41b","name":"","func":"if(msg.payload === \"ON\"){\n    global.set(\"alarmTrigger\", true);\n} else {\n    global.set(\"alarmTrigger\", false);\n}\nreturn msg;","outputs":1,"noerr":0,"x":1170,"y":460,"wires":[[]]},{"id":"8c3c5741.a5feb8","type":"ui_template","z":"d7b8c14c.bc41b","group":"12ab4c57.e83434","name":"","order":3,"width":"14","height":"7","format":"<style>\n#tagsTable {\n    font-family: \"Trebuchet MS\", Arial, Helvetica, sans-serif;\n    border-collapse: collapse;\n    width: 100%;\n    max-height: 100%;\n}\n\n#tagsTable td, #tagsTable th {\n    border: 1px solid #ddd;\n    padding: 8px;\n    color: black;\n    overflow-x:auto;\n}\n#customers tbody{\n  display:block;\n  width: 100%;\n  overflow: auto;\n  height: auto;\n}\n#customers thead tr {\n   display: block;\n}\n#tagsTable tr:nth-child(even){background-color: #f2f2f2;}\ntable tr:nth-child(odd) {\n  background-color: #ffffff;\n}\n\n#tagsTable tr:hover {background-color: #ddd;}\n\n#tagsTable th {\n    padding-top: 12px;\n    padding-bottom: 12px;\n    text-align: left;\n    background-color: #008080;\n    color: white;\n    height: 12px;\n}\n\n#input[type=\"button\"] {\n\ttransition: all .3s;\n    border: 1px solid #ddd;\n    padding: 8px 16px;\n    text-decoration: none;\n    border-radius: 5px;\n\tfont-size: 15px;\n}\n\n#input[type=\"button\"]:not(.active) {\n\tbackground-color:transparent;\n}\n\n.active {\n\tbackground-color: #ff4d4d;\n\tcolor :#fff;\n}\n\n#input[type=\"button\"]:hover:not(.active) {\n\tbackground-color: #ddd;\n}\n\n#start {\n    background-color: ForestGreen;\n    border: none;\n    color: white;\n    padding: 8px 20px;\n    border-radius: 8px;\n    text-align: center;\n    text-decoration: none;\n    display: inline-block;\n    font-size: 16px;\n    margin: 4px 2px;\n    cursor: pointer;\n}\n#start:disabled {\n    cursor: not-allowed;\n    background: gray;\n}\n#stop {\n\tbackground-color: Tomato;\n    border: none;\n    color: white;\n    padding: 8px 20px;\n    border-radius: 8px;\n    text-align: center;\n    text-decoration: none;\n    display: inline-block;\n    font-size: 16px;\n    margin: 4px 2px;\n    cursor: pointer;\n}\n#stop:disabled {\n    cursor: not-allowed;\n    background: gray;\n}\n</style>\n\n<div  align=\"center\" style=\"padding: inherit;\">\n    <label>\n        EPC\n    </label>\n    <input type=\"text\" id=\"epc-filter\" placeholder=\"EPC Filter\" ng-model=\"values.epcFilter\">\n     <button  id=\"start\"  ng-disabled=\"button.start\" ng-click=\"startFunc()\">START</button>\n    <button  id=\"stop\"  ng-disabled=\"button.stop\" ng-click=\"stopFunc()\">STOP</button>\n</div>\n\n\n<table id=\"tagsTable\">\n   <thead> \n        <tr height=\"12\">\n            <th>EPC</th>\n            <th>Timestamp</th> \n            <th>Logical Reader</th> \n        </tr>\n     </thead> \n    <tbody> \n        <tr ng-repeat=\"x in list\">\n            <td>{{ x.epc }}</td>\n            <td>{{ x.isoDate }}</td>\n            <td>{{ x.logicalReader }}</td>\n        </tr>\n    </tbody> \n</table>\n<pagination \n      ng-model=\"currentPage\"\n      total-items=\"list.length\"\n      max-size=\"maxSize\"  \n      boundary-links=\"true\">\n</pagination>\n\n<script>\n//console.log(\"ID\",scope.$id);\n//console.log(\"THEME\",scope.theme);\nvar paginationConf= {currentPage: 1, numPerPage: 10, maxSize: 5};\nvar eventConf = {on: true};\n(function(scope) {\n    scope.completeData = null;\n    scope.button = {start: true, stop: false};\n    // scope.currentPage=1;\n    // scope.numPerPage=10,\n    // scope.maxSize= 5;\n    scope.$watch('msg', function(msg) {\n        console.log('watch msg');\n        console.log(msg);\n    if(!eventConf.on){\n        return null;\n    }\n    if (msg) {\n      var data = JSON.stringify(msg.payload);\n      //if(!scope.completeData){\n          console.log(data);\n          scope.completeData= JSON.parse(data);\n          if(scope.filterValue){\n              findFiltered(scope.filterValue);\n          }else{\n            scope.list = JSON.parse(data); \n          }\n\n          //pagination(scope.list.length,scope);\n     // }\n    }\n  });\n  scope.$watch('values.epcFilter', function(value) {\n      console.log('value '+ value);\n      findFiltered(value);\n    \n  });\n  \n    scope.startFunc = function() {\n        console.log('start');\n        eventConf.on = true;\n        \n        //this.disabled = true;\n        //getElementById(\"stop\").disabled=true;\n        //document.getElementById('start').disabled = false;\n        scope.button.start = true;\n        scope.button.stop = false;\n        //document.getElementById('stop').disabled = false;\n    };\n    scope.stopFunc = function() {\n        console.log('stop');\n        eventConf.on = false;\n        //this.disabled = true;\n        //getElementById(\"start\").disabled=true;\n        scope.button.stop = true;\n        scope.button.start = false;\n        //document.getElementById('stop').disabled = false;\n        //document.getElementById('start').disabled = false;\n    };\n  \n  var findFiltered =  function(value){\n      if (value) {\n        scope.filterValue = value;\n        newValue =  value.split('|');\n        console.log('New Value '+ newValue);\n        var searchResults = [];\n        var keyValue= \"\";\n        var upperValue = \"\";\n        for (var filter=0; filter < newValue.length; filter++){\n            if(newValue[filter] ===\"\"){\n                continue;\n            }\n            console.log('este es el array value ' + newValue);\n            console.log('este es el key '+ filter);\n            console.log('este es el valor de la posision ' + newValue[filter])\n            upperValue = newValue[filter].toUpperCase();\n            console.log('value fomr array '+ upperValue);\n            console.log(upperValue);\n            for (var epc in scope.completeData){\n                if(epc){\n                    //console.log('entre aca dude ' + epc);\n                    keyValue = scope.completeData[epc];\n                    if(keyValue.hasOwnProperty('epc')){\n                        console.log(upperValue);\n                        if(keyValue['epc'].toUpperCase().indexOf(upperValue) !== -1){\n                            console.log('found Value in Array');\n                            console.log(keyValue);\n                            searchResults.push(keyValue);\n                        }\n                    }\n                }\n            }\n        }\n        scope.list = searchResults;\n        //pagination(searchResults.length);\n    } else {\n        scope.list = scope.completeData;\n    }\n  }\n  \n  function pagination(listLength){\n   //console.log(scope);\n    // get the table element\n    //var tableElement = document.getElementById(\"tagsTable\");\n    var $table = angular.element( document.querySelector( '#tagsTable' ) );\n    //var $table = angular.element(tableElement);\n    //console.log($table);\n    //console.log($table[0].rows.length);\n    $table = $table[0];\n    \n    //console.log($table);\n    //console.log($table.rows);\n    // number of rows per page\n    //var $n = 5;\n     //console.log($table.rows.length);\n    // console.log($table.rows[0]);\n    // console.log($table.rows[1]);\n    // number of rows of the table\n    //var $rowCount = $table.rows.length,\n     var $rowCount = listLength +1,\n    // get the first cell's tag name (in the first row)\n    $firstRow = $table.rows[0].firstElementChild.tagName,\n    // boolean var to check if table has a head row\n    $hasHead = ($firstRow === \"TH\"),\n    // an array to hold each row\n    $tr = [],\n    // loop counters, to start count from rows[1] (2nd row) if the first row has a head tag\n    $i,$ii,$j = ($hasHead)?1:0,\n    // holds the first row if it has a (<TH>) & nothing if (<TD>)\n    $th = ($hasHead?$table.rows[(0)].outerHTML:\"\");\n    // count the number of pages\n    //var $pageCount = Math.ceil($rowCount / $n);\n    console.log(paginationConf.numPerPage);\n    var $pageCount = Math.ceil($rowCount / paginationConf.numPerPage);\n    paginationConf.pageCount = $pageCount;\n    console.log($pageCount);\n    // if we had one page only, then we have nothing to do ..\n    if ($pageCount > 1) {\n    \t// assign each row outHTML (tag name & innerHTML) to the array\n    \t//for ($i = $j,$ii = 0; $i < $rowCount; $i++, $ii++)\n    \t\t//$tr[$ii] = $table.rows[$i].outerHTML;\n    \t// create a div block to hold the buttons\n    \t$table.insertAdjacentHTML(\"afterend\",\"<div id='buttons'></div\");\n    \t// the first sort, default page is the first one\n    \tsort(1);\n    }\n\n    \n    // ($p) is the selected page number. it will be generated when a user clicks a button\n    \n}\nfunction sort($p) {\n    console.log('entre aca');\n    console.log(scope);\n\t/* create ($rows) a variable to hold the group of rows\n\t** to be displayed on the selected page,\n\t** ($s) the start point .. the first row in each page, Do The Math\n\t*/\n\t\n\t/*var $rows = $th,$s = (($n * $p)-$n);\n\tfor ($i = $s; $i < ($s+$n) && $i < $tr.length; $i++)\n\t\t$rows += $tr[$i];\n\t\n\t\n\t// now the table has a processed group of rows ..\n\t$table.innerHTML = $rows;*/\n\tconsole.log($p);\n\tconsole.log(paginationConf.currentPage);\n\tpaginationConf.currentPage = $p;\n\t var begin = ((paginationConf.currentPage - 1) * paginationConf.numPerPage),\n     end = begin + paginationConf.numPerPage;\n     console.log(scope.list)\n     scope.list = scope.list.slice(begin, end);\n\t// create the pagination buttons\n\tdocument.getElementById(\"buttons\").innerHTML = pageButtons(paginationConf.pageCount,$p);\n\t// CSS Stuff\n\tdocument.getElementById(\"id\"+$p).setAttribute(\"class\",\"active\");\n}\n\n\n// ($pCount) : number of pages,($cur) : current page, the selected one ..\nfunction pageButtons($pCount,$cur) {\n\t/* this variables will disable the \"Prev\" button on 1st page\n\t   and \"next\" button on the last one */\n\tvar\t$prevDis = ($cur == 1)?\"disabled\":\"\",\n\t\t$nextDis = ($cur == $pCount)?\"disabled\":\"\",\n\t\t/* this ($buttons) will hold every single button needed\n\t\t** it will creates each button and sets the onclick attribute\n\t\t** to the \"sort\" function with a special ($p) number..\n\t\t*/\n\t\t$buttons = \"<input type='button' value='&lt;&lt; Prev' onclick='sort(\"+($cur - 1)+\")' \"+$prevDis+\">\";\n\tfor ($i=1; $i<=$pCount;$i++)\n\t\t$buttons += \"<input type='button' id='id\"+$i+\"'value='\"+$i+\"' onclick='sort(\"+$i+\")'>\";\n\t$buttons += \"<input type='button' value='Next &gt;&gt;' onclick='sort(\"+($cur + 1)+\")' \"+$nextDis+\">\";\n\treturn $buttons;\n}\n\n  \n  \n  \n})(scope);\n\n</script>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":980,"y":681,"wires":[[]]},{"id":"22d379d0.37e4a6","type":"inject","z":"d7b8c14c.bc41b","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":600,"y":640,"wires":[["e0a6b5d1.919f68"]]},{"id":"2acceb09.1c5904","type":"debug","z":"d7b8c14c.bc41b","name":"UI DISPLAY","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":650,"y":280,"wires":[]},{"id":"e0a6b5d1.919f68","type":"template","z":"d7b8c14c.bc41b","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"[\n{\"epc\":\"Alfreds Futterkiste\",\"timestamp\":\"Berlin\",\"Country\":\"Germany\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Ana Trujillo Emparedados y helados\",\"timestamp\":\"M�xico D.F.\",\"Country\":\"Mexico\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Antonio Moreno Taquer�a\",\"timestamp\":\"M�xico D.F.\",\"Country\":\"Mexico\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Around the Horn\",\"timestamp\":\"London\",\"Country\":\"UK\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"B's Beverages\",\"timestamp\":\"London\",\"Country\":\"UK\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Berglunds snabbk�p\",\"timestamp\":\"Lule�\",\"Country\":\"Sweden\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Blauer See Delikatessen\",\"timestamp\":\"Mannheim\",\"Country\":\"Germany\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Blondel p�re et fils\",\"timestamp\":\"Strasbourg\",\"Country\":\"France\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"B���lido Comidas preparadas\",\"timestamp\":\"Madrid\",\"Country\":\"Spain\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Bon app'\",\"timestamp\":\"Marseille\",\"Country\":\"France\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Bottom-Dollar Marketse\",\"timestamp\":\"Tsawassen\",\"Country\":\"Canada\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Cactus Comidas para llevar\",\"timestamp\":\"Buenos Aires\",\"Country\":\"Argentina\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Centro comercial Moctezuma\",\"timestamp\":\"M�xico D.F.\",\"Country\":\"Mexico\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Chop-suey Chinese\",\"timestamp\":\"Bern\",\"Country\":\"Switzerland\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Com�rcio Mineiro\",\"timestamp\":\"S�o Paulo\",\"Country\":\"Brazil\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Alfreds Futterkiste\",\"timestamp\":\"Berlin\",\"Country\":\"Germany\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Ana Trujillo Emparedados y helados\",\"timestamp\":\"M�xico D.F.\",\"Country\":\"Mexico\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Antonio Moreno Taquer�a\",\"timestamp\":\"M�xico D.F.\",\"Country\":\"Mexico\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Around the Horn\",\"timestamp\":\"London\",\"Country\":\"UK\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"B's Beverages\",\"timestamp\":\"London\",\"Country\":\"UK\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Berglunds snabbk�p\",\"timestamp\":\"Lule�\",\"Country\":\"Sweden\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Blauer See Delikatessen\",\"timestamp\":\"Mannheim\",\"Country\":\"Germany\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Blondel p�re et fils\",\"timestamp\":\"Strasbourg\",\"Country\":\"France\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"B��lido Comidas preparadas\",\"timestamp\":\"Madrid\",\"Country\":\"Spain\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Bon app'\",\"timestamp\":\"Marseille\",\"Country\":\"France\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Bottom-Dollar Marketse\",\"timestamp\":\"Tsawassen\",\"Country\":\"Canada\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Cactus Comidas para llevar\",\"timestamp\":\"Buenos Aires\",\"Country\":\"Argentina\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Centro comercial Moctezuma\",\"timestamp\":\"M�xico D.F.\",\"Country\":\"Mexico\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Chop-suey Chinese\",\"timestamp\":\"Bern\",\"Country\":\"Switzerland\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Com�rcio Mineiro\",\"timestamp\":\"S�o Paulo\",\"Country\":\"Brazil\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Alfreds Futterkiste\",\"timestamp\":\"Berlin\",\"Country\":\"Germany\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Ana Trujillo Emparedados y helados\",\"timestamp\":\"M�xico D.F.\",\"Country\":\"Mexico\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Antonio Moreno Taquer�a\",\"timestamp\":\"M�xico D.F.\",\"Country\":\"Mexico\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Around the Horn\",\"timestamp\":\"London\",\"Country\":\"UK\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"B's Beverages\",\"timestamp\":\"London\",\"Country\":\"UK\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Berglunds snabbk�p\",\"timestamp\":\"Lule�\",\"Country\":\"Sweden\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Blauer See Delikatessen\",\"timestamp\":\"Mannheim\",\"Country\":\"Germany\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Blondel p�re et fils\",\"timestamp\":\"Strasbourg\",\"Country\":\"France\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"B�lido Comidas preparadas\",\"timestamp\":\"Madrid\",\"Country\":\"Spain\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Bon app'\",\"timestamp\":\"Marseille\",\"Country\":\"France\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Bottom-Dollar Marketse\",\"timestamp\":\"Tsawassen\",\"Country\":\"Canada\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Cactus Comidas para llevar\",\"timestamp\":\"Buenos Aires\",\"Country\":\"Argentina\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Centro comercial Moctezuma\",\"timestamp\":\"M�xico D.F.\",\"Country\":\"Mexico\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Chop-suey Chinese\",\"timestamp\":\"Bern\",\"Country\":\"Switzerland\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Com�rcio Mineiro\",\"timestamp\":\"S�o Paulo\",\"Country\":\"Brazil\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Alfreds Futterkiste\",\"timestamp\":\"Berlin\",\"Country\":\"Germany\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Ana Trujillo Emparedados y helados\",\"timestamp\":\"M�xico D.F.\",\"Country\":\"Mexico\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Antonio Moreno Taquer�a\",\"timestamp\":\"M�xico D.F.\",\"Country\":\"Mexico\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Around the Horn\",\"timestamp\":\"London\",\"Country\":\"UK\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"B's Beverages\",\"timestamp\":\"London\",\"Country\":\"UK\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Berglunds snabbk�p\",\"timestamp\":\"Lule�\",\"Country\":\"Sweden\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Blauer See Delikatessen\",\"timestamp\":\"Mannheim\",\"Country\":\"Germany\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Blondel p�re et fils\",\"timestamp\":\"Strasbourg\",\"Country\":\"France\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"B�lido Comidas preparadas\",\"timestamp\":\"Madrid\",\"Country\":\"Spain\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Bon app'\",\"timestamp\":\"Marseille\",\"Country\":\"France\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Bottom-Dollar Marketse\",\"timestamp\":\"Tsawassen\",\"Country\":\"Canada\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Cactus Comidas para llevar\",\"timestamp\":\"Buenos Aires\",\"Country\":\"Argentina\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Centro comercial Moctezuma\",\"timestamp\":\"M�xico D.F.\",\"Country\":\"Mexico\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Chop-suey Chinese\",\"timestamp\":\"Bern\",\"Country\":\"Switzerland\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Com�rcio Mineiro\",\"timestamp\":\"S�o Paulo\",\"Country\":\"Brazil\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Alfreds Futterkiste\",\"timestamp\":\"Berlin\",\"Country\":\"Germany\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Ana Trujillo Emparedados y helados\",\"timestamp\":\"M�xico D.F.\",\"Country\":\"Mexico\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Antonio Moreno Taquer�a\",\"timestamp\":\"M�xico D.F.\",\"Country\":\"Mexico\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Around the Horn\",\"timestamp\":\"London\",\"Country\":\"UK\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"B's Beverages\",\"timestamp\":\"London\",\"Country\":\"UK\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Berglunds snabbk���p\",\"timestamp\":\"Lule�\",\"Country\":\"Sweden\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Blauer See Delikatessen\",\"timestamp\":\"Mannheim\",\"Country\":\"Germany\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Blondel p�re et fils\",\"timestamp\":\"Strasbourg\",\"Country\":\"France\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"B�lido Comidas preparadas\",\"timestamp\":\"Madrid\",\"Country\":\"Spain\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Bon app'\",\"timestamp\":\"Marseille\",\"Country\":\"France\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Bottom-Dollar Marketse\",\"timestamp\":\"Tsawassen\",\"Country\":\"Canada\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Cactus Comidas para llevar\",\"timestamp\":\"Buenos Aires\",\"Country\":\"Argentina\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Centro comercial Moctezuma\",\"timestamp\":\"M�xico D.F.\",\"Country\":\"Mexico\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Chop-suey Chinese\",\"timestamp\":\"Bern\",\"Country\":\"Switzerland\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Com�rcio Mineiro\",\"timestamp\":\"S�o Paulo\",\"Country\":\"Brazil\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Alfreds Futterkiste\",\"timestamp\":\"Berlin\",\"Country\":\"Germany\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Ana Trujillo Emparedados y helados\",\"timestamp\":\"M�xico D.F.\",\"Country\":\"Mexico\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Antonio Moreno Taquer�a\",\"timestamp\":\"M�xico D.F.\",\"Country\":\"Mexico\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Around the Horn\",\"timestamp\":\"London\",\"Country\":\"UK\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"B's Beverages\",\"timestamp\":\"London\",\"Country\":\"UK\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Berglunds snabbk��p\",\"timestamp\":\"Lule�\",\"Country\":\"Sweden\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Blauer See Delikatessen\",\"timestamp\":\"Mannheim\",\"Country\":\"Germany\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Blondel p�re et fils\",\"timestamp\":\"Strasbourg\",\"Country\":\"France\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"B�lido Comidas preparadas\",\"timestamp\":\"Madrid\",\"Country\":\"Spain\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Bon app'\",\"timestamp\":\"Marseille\",\"Country\":\"France\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Bottom-Dollar Marketse\",\"timestamp\":\"Tsawassen\",\"Country\":\"Canada\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Cactus Comidas para llevar\",\"timestamp\":\"Buenos Aires\",\"Country\":\"Argentina\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Centro comercial Moctezuma\",\"timestamp\":\"M�xico D.F.\",\"Country\":\"Mexico\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Chop-suey Chinese\",\"timestamp\":\"Bern\",\"Country\":\"Switzerland\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Com�rcio Mineiro\",\"timestamp\":\"S�o Paulo\",\"Country\":\"Brazil\", \"LogicalReader\":\"DDDGATE\"},{\"epc\":\"Alfreds Futterkiste\",\"timestamp\":\"Berlin\",\"Country\":\"Germany\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Ana Trujillo Emparedados y helados\",\"timestamp\":\"M�xico D.F.\",\"Country\":\"Mexico\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Antonio Moreno Taquer�a\",\"timestamp\":\"M�xico D.F.\",\"Country\":\"Mexico\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Around the Horn\",\"timestamp\":\"London\",\"Country\":\"UK\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"B's Beverages\",\"timestamp\":\"London\",\"Country\":\"UK\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Berglunds snabbk�p\",\"timestamp\":\"Lule�\",\"Country\":\"Sweden\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Blauer See Delikatessen\",\"timestamp\":\"Mannheim\",\"Country\":\"Germany\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Blondel p�re et fils\",\"timestamp\":\"Strasbourg\",\"Country\":\"France\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"B�lido Comidas preparadas\",\"timestamp\":\"Madrid\",\"Country\":\"Spain\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Bon app'\",\"timestamp\":\"Marseille\",\"Country\":\"France\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Bottom-Dollar Marketse\",\"timestamp\":\"Tsawassen\",\"Country\":\"Canada\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Cactus Comidas para llevar\",\"timestamp\":\"Buenos Aires\",\"Country\":\"Argentina\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Centro comercial Moctezuma\",\"timestamp\":\"M�xico D.F.\",\"Country\":\"Mexico\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Chop-suey Chinese\",\"timestamp\":\"Bern\",\"Country\":\"Switzerland\", \"LogicalReader\":\"DDDGATE\"},\n{\"epc\":\"Com�rcio Mineiro\",\"timestamp\":\"S�o Paulo\",\"Country\":\"Brazil\", \"LogicalReader\":\"DDDGATE\"}\n]","output":"json","x":760,"y":640,"wires":[["8c3c5741.a5feb8","defb3c4.62e38c"]]},{"id":"8412985.4de3768","type":"inject","z":"d7b8c14c.bc41b","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":600,"y":700,"wires":[["5b65b567.a954cc"]]},{"id":"5b65b567.a954cc","type":"template","z":"d7b8c14c.bc41b","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"[\n{\"Name\":\"Alfreds Futterkiste\",\"City\":\"Berlin\",\"Country\":\"Germany\", \"LogicalReader\":\"DDDGATE\"},\n{\"Name\":\"Ana Trujillo Emparedados y helados\",\"City\":\"M�xico D.F.\",\"Country\":\"Mexico\", \"LogicalReader\":\"DDDGATE\"},\n{\"Name\":\"Antonio Moreno Taquer�a\",\"City\":\"M�xico D.F.\",\"Country\":\"Mexico\", \"LogicalReader\":\"DDDGATE\"},\n{\"Name\":\"Around the Horn\",\"City\":\"London\",\"Country\":\"UK\", \"LogicalReader\":\"DDDGATE\"},\n{\"Name\":\"B's Beverages\",\"City\":\"London\",\"Country\":\"UK\", \"LogicalReader\":\"DDDGATE\"},\n{\"Name\":\"Berglunds snabbk�p\",\"City\":\"Lule�\",\"Country\":\"Sweden\", \"LogicalReader\":\"DDDGATE\"},\n{\"Name\":\"Blauer See Delikatessen\",\"City\":\"Mannheim\",\"Country\":\"Germany\", \"LogicalReader\":\"DDDGATE\"},\n{\"Name\":\"Blondel p�re et fils\",\"City\":\"Strasbourg\",\"Country\":\"France\", \"LogicalReader\":\"DDDGATE\"},\n{\"Name\":\"B�lido Comidas preparadas\",\"City\":\"Madrid\",\"Country\":\"Spain\", \"LogicalReader\":\"DDDGATE\"},\n{\"Name\":\"Bon app'\",\"City\":\"Marseille\",\"Country\":\"France\", \"LogicalReader\":\"DDDGATE\"},\n{\"Name\":\"Bottom-Dollar Marketse\",\"City\":\"Tsawassen\",\"Country\":\"Canada\", \"LogicalReader\":\"DDDGATE\"},\n{\"Name\":\"Cactus Comidas para llevar\",\"City\":\"Buenos Aires\",\"Country\":\"Argentina\", \"LogicalReader\":\"DDDGATE\"},\n{\"Name\":\"Centro comercial Moctezuma\",\"City\":\"M�xico D.F.\",\"Country\":\"Mexico\", \"LogicalReader\":\"DDDGATE\"},\n{\"Name\":\"Chop-suey Chinese\",\"City\":\"Bern\",\"Country\":\"Switzerland\", \"LogicalReader\":\"DDDGATE\"},\n{\"Name\":\"Com�rcio Mineiro\",\"City\":\"S�o Paulo\",\"Country\":\"Brazil\", \"LogicalReader\":\"DDDGATE\"}\n]","output":"json","x":760,"y":700,"wires":[["8c3c5741.a5feb8"]]},{"id":"c55d952d.2ce2f8","type":"function","z":"d7b8c14c.bc41b","name":"Events retencion","func":"if(!!msg.payload){\n    var eventStats = flow.get(\"eventList\") || {stolen: [], unknown:[], sold:[], blackList:[] };\n    var events = msg.payload;\n    var eventsInject = {\"redLight\":\"stolen\",\"yellowDisplay\": \"unknown\", \"greenLight\": \"sold\" };\n    var eventType = \"\";\n    var chart = [];\n    if(msg.redLight){ \n        eventType = \"redLight\";\n        //node.warn('redLigth entre');\n        if(!eventStats.hasOwnProperty('stolen') || eventStats['stolen'].length === 0){\n            eventStats.stolen = events;\n        }else{\n            eventStats.stolen = events.concat(eventStats.stolen);\n        }\n        node.send({payload:eventStats.stolen.slice(0,49),eventType:eventType, redLight: true});\n    }\n    if(msg.yellowDisplay){\n        eventType = \"yellowDisplay\";\n        //node.warn('yellow entre');\n        if(!eventStats.hasOwnProperty('unknown') || eventStats['unknown'].length === 0){\n            eventStats.unknown = events;\n        }else{\n            eventStats.unknown = events.concat(eventStats.unknown);\n        }\n        node.send({payload:eventStats.unknown.slice(0,49),eventType:eventType,yellowDisplay:true});\n    }\n    if(msg.greenLight){\n        eventType = \"greenLight\";\n        //node.warn('green entre');\n        if(!eventStats.hasOwnProperty('sold') || eventStats['sold'].length === 0){\n            eventStats.sold = events;\n        }else{\n             eventStats.sold = events.concat(eventStats.sold);\n        } \n        node.send({payload: eventStats.sold.slice(0,49), eventType:eventType,greenLight:true});\n    }\n    if(msg.blackList){\n        //node.warn('blackList');\n        eventType = \"blackList\";\n        if(!eventStats.hasOwnProperty('blackList') || eventStats['blackList'].length === 0){\n            eventStats.blackList = events;\n        }else{\n             eventStats.blackList = events.concat(eventStats.blackList);\n        } \n        node.send({payload: eventStats.blackList.slice(0,49), eventType:eventType,blackList:true});\n    }\n   // node.warn('llego aca?'),\n    flow.set('eventList',eventStats);\n}\n\nreturn null;","outputs":1,"noerr":0,"x":430,"y":220,"wires":[["290a396f.3ba1d6","2acceb09.1c5904"]]},{"id":"290a396f.3ba1d6","type":"switch","z":"d7b8c14c.bc41b","name":"","property":"eventType","propertyType":"msg","rules":[{"t":"eq","v":"redLight","vt":"str"},{"t":"eq","v":"yellowDisplay","vt":"str"},{"t":"eq","v":"greenLight","vt":"str"},{"t":"eq","v":"blackList","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":670,"y":240,"wires":[["18be2ea7.8e56e1"],["38841b13.9445d4"],["90c12162.65486"],["903b8704.4abd38"]]},{"id":"defb3c4.62e38c","type":"debug","z":"d7b8c14c.bc41b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1130,"y":640,"wires":[]},{"id":"36a16625.535c8a","type":"link in","z":"d7b8c14c.bc41b","name":"Tag Viewer IN","links":["167ff398.fde91c","f948c58e.bfbd88"],"x":815,"y":600,"wires":[["7507209d.1eca8"]]},{"id":"7507209d.1eca8","type":"change","z":"d7b8c14c.bc41b","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"epcList","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":940,"y":560,"wires":[["defb3c4.62e38c","2896c8d7.38c878"]]},{"id":"2896c8d7.38c878","type":"function","z":"d7b8c14c.bc41b","name":"Data Retention","func":"if(!!msg.payload){\n    // var clean = flow.get('autoClean') || false;\n    // node.warn('clean' + clean);\n    // if(clean){\n    //     return msg;\n    // } else {\n        var eventStats = flow.get(\"tagList\") || [];\n        var events = msg.payload;\n        \n        if(eventStats.length === 0){\n            eventStats = events;\n        }else{\n            eventStats = events.concat(eventStats);\n        }\n        flow.set('tagList',eventStats);\n        return {payload:eventStats.slice(0,49)};\n   // }\n}\nreturn null;","outputs":1,"noerr":0,"x":1180,"y":560,"wires":[["8c3c5741.a5feb8"]]},{"id":"2ab53aef.1f4386","type":"delay","z":"d7b8c14c.bc41b","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1400,"y":560,"wires":[["b1cc0f68.2e2c7"]]},{"id":"b1cc0f68.2e2c7","type":"function","z":"d7b8c14c.bc41b","name":"","func":"flow.set('autoClean',true);\nreturn msg;","outputs":1,"noerr":0,"x":1430,"y":620,"wires":[[]]},{"id":"5be6ff81.e3283","type":"inject","z":"d7b8c14c.bc41b","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":740,"y":840,"wires":[["a581189f.b1b9d8"]]},{"id":"a581189f.b1b9d8","type":"function","z":"d7b8c14c.bc41b","name":"","func":"var eventList = flow.get(\"eventList\") || [];\nnode.warn(eventList);\nvar eventsTable = [];\nvar tmpObject = {};\nfor (var event in eventList) {\n    for(var i=0; i<eventList[event].length; i++ ){\n        tmpObject =  eventList[event][i];\n        tmpObject.category = event;\n        eventsTable.push(tmpObject);\n    }\n}\nmsg.payload = eventsTable;\nreturn msg;","outputs":1,"noerr":0,"x":890,"y":840,"wires":[["9c4ba0c4.bc25e","defb3c4.62e38c"]]},{"id":"9c4ba0c4.bc25e","type":"ui_template","z":"d7b8c14c.bc41b","group":"41d308fa.98faa8","name":"","order":3,"width":"20","height":"10","format":"<style>\n#reportTable {\n    font-family: \"Trebuchet MS\", Arial, Helvetica, sans-serif;\n    border-collapse: collapse;\n    width: 100%;\n    max-height: 100%;\n}\n\n#reportTable td, #tagsTable th {\n    border: 1px solid #ddd;\n    padding: 8px;\n    color: black;\n    overflow-x:auto;\n}\n#customers tbody{\n  display:block;\n  width: 100%;\n  min-height: 404px !important;\n  max-height: 404px !important;\n  overflow: auto;\n  height: auto;\n}\n#customers thead tr {\n   display: block;\n}\n#reportTable tr:nth-child(even){background-color: #f2f2f2;}\ntable tr:nth-child(odd) {\n  background-color: #ffffff;\n}\n\n#reportTable tr:hover {\n    background-color: #ddd;\n}\n\n#reportTable th {\n    padding-top: 12px;\n    padding-bottom: 12px;\n    text-align: left;\n    background-color: #008080;\n    color: #eeeeee;\n    height: 12px;\n}\n\n#input[type=\"button\"] {\n\ttransition: all .3s;\n    border: 1px solid #ddd;\n    padding: 8px 16px;\n    text-decoration: none;\n    border-radius: 5px;\n\tfont-size: 15px;\n}\n\n#input[type=\"button\"]:not(.active) {\n\tbackground-color:transparent;\n}\n\n.active {\n\tbackground-color: #ff4d4d;\n\tcolor :#fff;\n}\n\n#input[type=\"button\"]:hover:not(.active) {\n\tbackground-color: #ddd;\n}\n\n#start {\n    background-color: ForestGreen;\n    border: none;\n    color: white;\n    padding: 8px 20px;\n    border-radius: 8px;\n    text-align: center;\n    text-decoration: none;\n    display: inline-block;\n    font-size: 16px;\n    margin: 4px 2px;\n    cursor: pointer;\n}\n#start:disabled {\n    cursor: not-allowed;\n    background: gray;\n}\n#stop {\n\tbackground-color: Tomato;\n    border: none;\n    color: white;\n    padding: 8px 20px;\n    border-radius: 8px;\n    text-align: center;\n    text-decoration: none;\n    display: inline-block;\n    font-size: 16px;\n    margin: 4px 2px;\n    cursor: pointer;\n}\n#stop:disabled {\n    cursor: not-allowed;\n    background: gray;\n}\n.center {\n    text-align: center;\n    display: inline-block;\n}\n.pagination {\n    display: inline-flex;\n}\n\n.pagination a {\n    color: white;\n    float: left;\n    padding: 8px 16px;\n    text-decoration: none;\n}\n\n.pagination a.active {\n    background-color: #4CAF50;\n    color: white;\n    border-radius: 5px;\n}\n\n.pagination a:hover:not(.active) {\n    background-color: #ddd;\n    border-radius: 5px;\n}\n</style>\n\n<div  align=\"center\" style=\"padding: inherit;\">\n    <label>\n        EPC\n    </label>\n    <input type=\"text\" id=\"epc-filter\" placeholder=\"EPC Filter\" ng-model=\"values.epcFilter\">\n     <button  id=\"start\"  ng-disabled=\"button.start\" ng-click=\"startFunc()\">START</button>\n    <button  id=\"stop\"  ng-disabled=\"button.stop\" ng-click=\"stopFunc()\">STOP</button>\n</div>\n\n\n<table id=\"reportTable\">\n   <thead> \n        <tr height=\"12\">\n            <th>EPC</th>\n            <th>Timestamp</th>\n            <th>Iso Date</th>\n            <th>Logical Reader</th> \n        </tr>\n     </thead> \n    <tbody> \n        <tr ng-repeat=\"x in list\">\n            <td>{{ x.epc }}</td>\n            <td>{{ x.timestamp }}</td>\n            <td>{{ x.isoDate }}</td>\n            <td>{{ x.logicalReader }}</td>\n        </tr>\n    </tbody> \n</table>\n<div class=\"center\">\n    <div class=\"pagination\">\n      <a ng-click=\"pageChange('prev')\" href=\"#\">&laquo;</a>\n      <div>\n      <a href=\"#\" ng-repeat=\"x in pagination\" ng-click=\"displayPageData(x.id)\"  ng-class=\"{active: x.active === true}\" >{{x.id}}</a>\n      </div>\n     \n      <a ng-click=\"pageChange('next')\" href=\"#\">&raquo;</a>\n    </div>\n</div>\n\n\n<script>\n//console.log(\"ID\",scope.$id);\n//console.log(\"THEME\",scope.theme);\nvar paginationConf= {currentPage: 1, numPerPage: 10, maxSize: 5, completeData: []};\nvar eventConf = {on: true};\n(function(scope) {\n    scope.completeData = null;\n    scope.button = {start: true, stop: false};\n    // scope.currentPage=1;\n    // scope.numPerPage=10,\n    // scope.maxSize= 5;\n    \n    scope.displayPageData = function(pageNum) {\n        console.log('entre al inicio');\n        console.log(pageNum)\n        var pagination = scope.pagination; \n        console.log(pagination.length);\n        scope.pagination = [];\n        for (var i = 1; i<=pagination.length; i++){\n            if(i===pageNum){\n                scope.pagination.push({id: i, active:true});\n                paginationConf.currentPage = pageNum;\n            }else{\n                scope.pagination.push({id: i, active: false});\n            }\n            //console.log(scope.pagination);\n        }\n        var begin = ((paginationConf.currentPage - 1) * paginationConf.numPerPage),\n        end = begin + paginationConf.numPerPage;\n        console.log(begin);\n        console.log(end);\n        scope.list = paginationConf.completeData.slice(begin, end);\n        \n    };\n    \n    scope.$watch('msg', function(msg) {\n        \n    if(!eventConf.on){\n        return null;\n    }\n    if (msg) {\n      var data = JSON.stringify(msg.payload);\n      //if(!scope.completeData){\n          console.log(data);\n          scope.completeData= JSON.parse(data);\n          paginationObj(scope.completeData);\n          if(scope.filterValue){\n              findFiltered(scope.filterValue);\n          }else{\n            scope.list = JSON.parse(data);\n            paginationConf.completeData = scope.list;\n          }\n\n          scope.displayPageData(paginationConf.currentPage);\n     // }\n    }\n  });\n  scope.$watch('values.epcFilter', function(value) {\n      console.log('value '+ value);\n      findFiltered(value);\n    \n  });\n  \n    scope.startFunc = function() {\n        console.log('start');\n        eventConf.on = true;\n        \n        //this.disabled = true;\n        //getElementById(\"stop\").disabled=true;\n        //document.getElementById('start').disabled = false;\n        scope.button.start = true;\n        scope.button.stop = false;\n        //document.getElementById('stop').disabled = false;\n    };\n    scope.stopFunc = function() {\n        console.log('stop');\n        eventConf.on = false;\n        //this.disabled = true;\n        //getElementById(\"start\").disabled=true;\n        scope.button.stop = true;\n        scope.button.start = false;\n        //document.getElementById('stop').disabled = false;\n        //document.getElementById('start').disabled = false;\n    };\n    scope.pageChange = function(value){\n        if(value === 'prev'){\n            if(paginationConf.currentPage > 1 ){\n                scope.displayPageData(paginationConf.currentPage -1);\n            }\n        } else{\n            if( value=== 'next'){\n                if(paginationConf.currentPage < paginationConf.pageCount){\n                    scope.displayPageData(paginationConf.currentPage +1);\n                }\n            }\n        }\n        paginationConf.currentPage = pageNum;\n        console.log(value);\n    }\n\n  \n  var findFiltered =  function(value){\n      if (value) {\n        scope.filterValue = value;\n        newValue =  value.split('|');\n        console.log('New Value '+ newValue);\n        var searchResults = [];\n        var keyValue= \"\";\n        var upperValue = \"\";\n        for (var filter=0; filter < newValue.length; filter++){\n            if(newValue[filter] ===\"\"){\n                continue;\n            }\n            console.log('este es el array value ' + newValue);\n            console.log('este es el key '+ filter);\n            console.log('este es el valor de la posision ' + newValue[filter])\n            upperValue = newValue[filter].toUpperCase();\n            console.log('value fomr array '+ upperValue);\n            console.log(upperValue);\n            for (var epc in scope.completeData){\n                if(epc){\n                    //console.log('entre aca dude ' + epc);\n                    keyValue = scope.completeData[epc];\n                    if(keyValue.hasOwnProperty('epc')){\n                        console.log(upperValue);\n                        if(keyValue['epc'].toUpperCase().indexOf(upperValue) !== -1){\n                            console.log('found Value in Array');\n                            console.log(keyValue);\n                            searchResults.push(keyValue);\n                        }\n                    }\n                }\n            }\n        }\n        scope.list = searchResults;\n        paginationConf.completeData = scope.list;\n        //pagination(searchResults.length);\n    } else {\n        scope.list = scope.completeData;\n        paginationConf.completeData = scope.list;\n    }\n  }\n  var paginationObj = function(list){\n      scope.pagination = [];\n      var pageCount = Math.ceil(list.length / 10);\n      for(var i = 1; i <= pageCount; i++){\n          if(i===1){\n              paginationConf.currentPage = 1;\n              scope.pagination.push({id: i, active:true});\n          }else{\n            scope.pagination.push({id: i, active: false});\n          }\n          paginationConf.pageCount = pageCount;\n          console.log(scope.pagination);\n      }\n  }\n  \n\n})(scope);\n\n</script>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1040,"y":840,"wires":[[]]},{"id":"8d9d5369.22529","type":"ui_text","z":"d7b8c14c.bc41b","group":"67bc486a.208ea8","order":1,"width":"6","height":"3","name":"","label":"POE GATE","format":"{{msg.payload.logicalReader}}","layout":"col-center","x":410,"y":380,"wires":[]},{"id":"903b8704.4abd38","type":"ui_template","z":"d7b8c14c.bc41b","group":"67bc486a.208ea8","name":"","order":0,"width":"8","height":"5","format":"<!-- <div class=\"w3-container\" margin=\"auto\">\n    <div layout=\"row\" layout-align=\"space-between\">\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\"> EPC SOLD</p>\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\">\n          {{(msg.payload.epc || 0) }}\n        </p>\n    </div>\n     <div ng-if = \"msg.greenLight\" layout=\"row\" layout-align=\"space-between\" >\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\">SKU: </p>\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\">\n             {{(msg.payload.SKU ||  \"0\") }} \n        </p>\n    </div>\n     <div ng-if = \"msg.greenLight\" layout=\"row\" layout-align=\"space-between\"  >\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\">Class: </p>\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\"> {{(msg.payload.Class || \"\" ) }} </p>\n        \n    </div>\n    <div ng-if = \"msg.greenLight\" layout=\"row\" layout-align=\"space-between\"  >\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\">Department: </p>\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\"> {{(msg.payload.Department || \"\" ) }} </p>\n        \n    </div>\n    <div ng-if = \"msg.greenLight\" layout=\"row\" layout-align=\"space-between\" >\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\">SA Clearance: </p>\n        <p ng-style=\"{color: 'green'}\" ng-if = \"msg.greenLight\"> {{(msg.payload.SA_Clearance || \"\" ) }} </p>\n        \n    </div>\n</div> -->\n\n<div class=\"w3-container\" margin=\"auto\" ng-repeat=\"x in msg.payload\">\n    <div layout=\"row\" layout-align=\"space-between\">\n        <p ng-style=\"{color: 'Teal'}\" ng-if = \"msg.blackList\"> EPC DISPLAY</p>\n        <p ng-style=\"{color: 'Teal'}\" ng-if = \"msg.blackList\">\n          {{(x.epc || 0) }}\n        </p>\n    </div>\n     <div ng-if = \"msg.blackList\" layout=\"row\" layout-align=\"space-between\" >\n        <p ng-style=\"{color: 'Teal'}\" ng-if = \"msg.blackList\">SKU: </p>\n        <p ng-style=\"{color: 'Teal'}\" ng-if = \"msg.blackList\">\n             {{(x.SKU ||  \"0\") }} \n        </p>\n    </div>\n     <div ng-if = \"msg.blackList\" layout=\"row\" layout-align=\"space-between\"  >\n        <p ng-style=\"{color: 'Teal'}\" ng-if = \"msg.blackList\">Class: </p>\n        <p ng-style=\"{color: 'Teal'}\" ng-if = \"msg.blackList\"> {{(x.Class || \"\" ) }} </p>\n        \n    </div>\n    <div ng-if = \"msg.blackList\" layout=\"row\" layout-align=\"space-between\"  >\n        <p ng-style=\"{color: 'Teal'}\" ng-if = \"msg.blackList\">Department: </p>\n        <p ng-style=\"{color: 'Teal'}\" ng-if = \"msg.blackList\"> {{(x.Department || \"\" ) }} </p>\n        \n    </div>\n    <div ng-if = \"msg.blackList\" layout=\"row\" layout-align=\"space-between\" style= \"border-width: 2px;border-bottom-width:2px; border-bottom-color:DarkGray;border-bottom-style: solid;\" >\n        <p ng-style=\"{color: 'Teal'}\" ng-if = \"msg.blackList\">SA Clearance: </p>\n        <p ng-style=\"{color: 'Teal'}\" ng-if = \"msg.blackList\"> {{(x.SA_Clearance || \"\" ) }} </p>\n        \n    </div>\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":880,"y":340,"wires":[[]]},{"id":"6a2cc6ef.aa0c18","type":"ui_template","z":"d7b8c14c.bc41b","group":"599bd659.c03608","name":"","order":3,"width":"14","height":"7","format":"<style>\n#tagsTable {\n    font-family: \"Trebuchet MS\", Arial, Helvetica, sans-serif;\n    border-collapse: collapse;\n    width: 100%;\n    max-height: 100%;\n}\n\n#tagsTable td, #tagsTable th {\n    border: 1px solid #ddd;\n    padding: 8px;\n    color: black;\n    overflow-x:auto;\n}\n#customers tbody{\n  display:block;\n  width: 100%;\n  overflow: auto;\n  height: auto;\n}\n#customers thead tr {\n   display: block;\n}\n#tagsTable tr:nth-child(even){background-color: #f2f2f2;}\ntable tr:nth-child(odd) {\n  background-color: #ffffff;\n}\n\n#tagsTable tr:hover {background-color: #ddd;}\n\n#tagsTable th {\n    padding-top: 12px;\n    padding-bottom: 12px;\n    text-align: left;\n    background-color: #008080;\n    color: white;\n    height: 12px;\n}\n\n#input[type=\"button\"] {\n\ttransition: all .3s;\n    border: 1px solid #ddd;\n    padding: 8px 16px;\n    text-decoration: none;\n    border-radius: 5px;\n\tfont-size: 15px;\n}\n\n#input[type=\"button\"]:not(.active) {\n\tbackground-color:transparent;\n}\n\n.active {\n\tbackground-color: #ff4d4d;\n\tcolor :#fff;\n}\n\n#input[type=\"button\"]:hover:not(.active) {\n\tbackground-color: #ddd;\n}\n\n#start {\n    background-color: ForestGreen;\n    border: none;\n    color: white;\n    padding: 8px 20px;\n    border-radius: 8px;\n    text-align: center;\n    text-decoration: none;\n    display: inline-block;\n    font-size: 16px;\n    margin: 4px 2px;\n    cursor: pointer;\n}\n#start:disabled {\n    cursor: not-allowed;\n    background: gray;\n}\n#stop {\n\tbackground-color: Tomato;\n    border: none;\n    color: white;\n    padding: 8px 20px;\n    border-radius: 8px;\n    text-align: center;\n    text-decoration: none;\n    display: inline-block;\n    font-size: 16px;\n    margin: 4px 2px;\n    cursor: pointer;\n}\n#stop:disabled {\n    cursor: not-allowed;\n    background: gray;\n}\n</style>\n\n<div  align=\"center\" style=\"padding: inherit;\">\n    <label>\n        EPC\n    </label>\n    <input type=\"text\" id=\"epc-filter\" placeholder=\"EPC Filter\" ng-model=\"values.epcFilter\">\n     <button  id=\"start\"  ng-disabled=\"button.start\" ng-click=\"startFunc()\">START</button>\n    <button  id=\"stop\"  ng-disabled=\"button.stop\" ng-click=\"stopFunc()\">STOP</button>\n</div>\n\n\n<table id=\"tagsTable\">\n   <thead> \n        <tr height=\"12\">\n            <th>EPC</th>\n            <th>POS TIME</th> \n            <th>POS ViZix TIME</th> \n            <th>Transaction Type</th> \n        </tr>\n     </thead> \n    <tbody> \n        <tr ng-repeat=\"x in list\">\n            <td>{{ x.epc }}</td>\n            <td>{{ x.date_time.value.ISO_String }}</td>\n            <td>{{ x.date_time.value.vizixTime }}</td>\n            <td>{{ x.transactionEvent }}</td>\n        </tr>\n    </tbody> \n</table>\n<pagination \n      ng-model=\"currentPage\"\n      total-items=\"list.length\"\n      max-size=\"maxSize\"  \n      boundary-links=\"true\">\n</pagination>\n\n<script>\n//console.log(\"ID\",scope.$id);\n//console.log(\"THEME\",scope.theme);\nvar paginationConf= {currentPage: 1, numPerPage: 10, maxSize: 5};\nvar eventConf = {on: true};\n(function(scope) {\n    scope.completeData = null;\n    scope.button = {start: true, stop: false};\n    // scope.currentPage=1;\n    // scope.numPerPage=10,\n    // scope.maxSize= 5;\n    scope.$watch('msg', function(msg) {\n        console.log('watch msg');\n        console.log(msg);\n    if(!eventConf.on){\n        return null;\n    }\n    if (msg) {\n      var data = JSON.stringify(msg.payload);\n      //if(!scope.completeData){\n          console.log(data);\n          scope.completeData= JSON.parse(data);\n          if(scope.filterValue){\n              findFiltered(scope.filterValue);\n          }else{\n            scope.list = JSON.parse(data); \n          }\n\n          //pagination(scope.list.length,scope);\n     // }\n    }\n  });\n  scope.$watch('values.epcFilter', function(value) {\n      console.log('value '+ value);\n      findFiltered(value);\n    \n  });\n  \n    scope.startFunc = function() {\n        console.log('start');\n        eventConf.on = true;\n        \n        //this.disabled = true;\n        //getElementById(\"stop\").disabled=true;\n        //document.getElementById('start').disabled = false;\n        scope.button.start = true;\n        scope.button.stop = false;\n        //document.getElementById('stop').disabled = false;\n    };\n    scope.stopFunc = function() {\n        console.log('stop');\n        eventConf.on = false;\n        //this.disabled = true;\n        //getElementById(\"start\").disabled=true;\n        scope.button.stop = true;\n        scope.button.start = false;\n        //document.getElementById('stop').disabled = false;\n        //document.getElementById('start').disabled = false;\n    };\n  \n    var findFiltered =  function(value){\n        if (value) {\n        scope.filterValue = value;\n        newValue =  value.split('|');\n        console.log('New Value '+ newValue);\n        var searchResults = [];\n        var keyValue= \"\";\n        var upperValue = \"\";\n        for (var filter=0; filter < newValue.length; filter++){\n            if(newValue[filter] ===\"\"){\n                continue;\n            }\n            //console.log('este es el array value ' + newValue);\n            //console.log('este es el key '+ filter);\n            //console.log('este es el valor de la posision ' + newValue[filter])\n            upperValue = newValue[filter].toUpperCase();\n            //console.log('value fomr array '+ upperValue);\n            //console.log(upperValue);\n            for (var epc in scope.completeData){\n                if(epc){\n                    //console.log('entre aca dude ' + epc);\n                    keyValue = scope.completeData[epc];\n                    if(keyValue.hasOwnProperty('epc')){\n                        console.log(upperValue);\n                        if(keyValue['epc'].toUpperCase().indexOf(upperValue) !== -1){\n                            console.log('found Value in Array');\n                            console.log(keyValue);\n                            searchResults.push(keyValue);\n                        }\n                    }\n                }\n            }\n        }\n        scope.list = searchResults;\n        //pagination(searchResults.length);\n        } else {\n            scope.list = scope.completeData;\n        }\n    }\n \n})(scope);\n\n</script>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1260,"y":720,"wires":[[]]},{"id":"5b60fb43.942e74","type":"link in","z":"d7b8c14c.bc41b","name":"Black List In","links":["bdcadd91.9a28d"],"x":235,"y":380,"wires":[["8d9d5369.22529","c55d952d.2ce2f8","77f72c49.859cb4"]]},{"id":"4bc1e6f5.cfc5e8","type":"function","z":"d7b8c14c.bc41b","name":"","func":"node.warn('TEST DESDE ESTE NODO');\nnode.warn(msg);\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":340,"wires":[[]]},{"id":"1f69d020.7222","type":"link in","z":"d7b8c14c.bc41b","name":"POS Dash IN","links":["6cb82dfb.39d774","7d52ec52.08c024"],"x":935,"y":720,"wires":[["23204eef.ed8452"]]},{"id":"23204eef.ed8452","type":"function","z":"d7b8c14c.bc41b","name":"Data Retention","func":"if(!!msg.payload){\n    var epcList= msg.payload;\n    var list= [];\n    for (var epc in epcList){\n        epcList[epc]['epc'] = epc; \n        list.push(epcList[epc]);\n    }\n    var eventStats = flow.get(\"posList\") || [];\n    //var events = msg.payload;\n    node.warn('list');\n    node.warn(list);\n    if(eventStats.length === 0){\n        eventStats = list;\n    }else{\n        eventStats = list.concat(eventStats);\n    }\n    flow.set('posList',eventStats);\n    return {payload:eventStats.slice(0,49)};\n}\nreturn null;","outputs":1,"noerr":0,"x":1080,"y":720,"wires":[["6a2cc6ef.aa0c18"]]},{"id":"f3fea99f.7a53d8","type":"ui_gauge","z":"d7b8c14c.bc41b","name":"","group":"78053794.771368","order":3,"width":"5","height":"3.5","gtype":"donut","title":"Display","label":"units","format":"{{value}}","min":0,"max":"100","colors":["#2789be","#2789be","#2789be"],"seg1":"","seg2":"","x":740,"y":580,"wires":[]},{"id":"2ac669f5.070736","type":"DataIn","z":"d7b8c14c.bc41b","collection":"a2c4fb3a.242f18","name":"Report Data","update":true,"path":"/","x":630,"y":320,"wires":[]},{"id":"2a5a8943.e7f976","type":"ui_group","z":"","name":"Stolen Events","tab":"bf982489.cf50a8","order":2,"disp":true,"width":"7","collapse":false},{"id":"f4c9a41c.645928","type":"ui_group","z":"","name":"Unknown Events","tab":"bf982489.cf50a8","order":1,"disp":true,"width":"7","collapse":false},{"id":"453b4738.0acee8","type":"ui_group","z":"","name":"POS Events","tab":"bf982489.cf50a8","order":3,"disp":true,"width":"7","collapse":false},{"id":"78053794.771368","type":"ui_group","z":"","name":"Events","tab":"bf982489.cf50a8","order":5,"disp":true,"width":"5","collapse":true},{"id":"41d308fa.98faa8","type":"ui_group","z":"","name":"Analytics","tab":"c4aa17b4.28e2e8","order":6,"disp":true,"width":"21","collapse":false},{"id":"12ab4c57.e83434","type":"ui_group","z":"","name":"Tag Viewer","tab":"bf982489.cf50a8","order":6,"disp":true,"width":"14","collapse":false},{"id":"67bc486a.208ea8","type":"ui_group","z":"","name":"Black List Events","tab":"bf982489.cf50a8","order":4,"disp":true,"width":"7","collapse":false},{"id":"599bd659.c03608","type":"ui_group","z":"","name":"POS Viewer","tab":"bf982489.cf50a8","order":7,"disp":true,"width":"14","collapse":false},{"id":"a2c4fb3a.242f18","type":"json-db-collection","z":"","name":"Report Data","folder":"/flows/","collection":"REPO_DATA","save":true},{"id":"bf982489.cf50a8","type":"ui_tab","z":"","name":"Home","icon":"dashboard"},{"id":"c4aa17b4.28e2e8","type":"ui_tab","z":"","name":"Reports","icon":"dashboard"}]